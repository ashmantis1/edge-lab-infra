# yaml-language-server: $schema=https://kubernetes-schemas.devbu.io/helm.toolkit.fluxcd.io/helmrelease_v2beta1.json
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: keycloak
spec:
  chart:
    spec:
      version: "21.6.0"
  values: 
    production: true
    proxy: passthrough
    tls: 
      enabled: true
      autoGenerated: true
    postgresql:
      enabled: false
    externalDatabase: 
      existingSecret: keycloak-postgres-app
      existingSecretHostKey: host
      existingSecretPortKey: port
      existingSecretUserKey: user
      existingSecretDatabaseKey: dbname
      existingSecretPasswordKey: password
    ingress:
      enabled: true
      ingressClassName: nginx
      servicePort: https
      hostname: sso.infra.ashman.world
      annotations:
        cert-manager.io/cluster-issuer: "letsencrypt-prod"
        nginx.ingress.kubernetes.io/backend-protocol: "HTTPS"
        nginx.ingress.kubernetes.io/proxy-ssl-verify: "off"
      tls: true

