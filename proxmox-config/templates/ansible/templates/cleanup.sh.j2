#!/bin/bash
rm "{{ ipajoin_bin_location }}"

service_exists() {
    local n=$1
    if [[ $(systemctl list-units --all -t service --full --no-legend "$n.service" | sed 's/^\s*//g' | cut -f1 -d' ') == $n.service ]]; then
        return 0
    else
        return 1
    fi
}

if service_exists systemd-resolved
then
  systemctl  unmask systemd-resolved
  systemctl enable --now systemd-resolved
fi


if [[ -f /etc/ipa/ca.crt ]]
then
  userdel --force cloud-user
  userdel --force fedora
fi

systemctl disable --now ipajoin.service

